async function loadJoke(){try{const t=await fetch("https://yewjin.com/assets/html/joke.html"),o=await t.text(),n=(new DOMParser).parseFromString(o,"text/html"),a=n.querySelector("style").textContent;console.log("Style content:",a);const r=a.match(/background-image:\s*url\s*\(\s*['"]?data:image\/jpeg;base64,([^'")\s]+)['"]?\s*\)/i);console.log("Match result:",r),currentJoke.lead=n.querySelector("h1").textContent,currentJoke.punchline=n.querySelector(".punchline").textContent,jokeLead.textContent=currentJoke.lead,jokePunchline.textContent=currentJoke.punchline,r&&r[1]&&(container.style.backgroundImage=`url('data:image/jpeg;base64,${r[1]}')`);const l=JSON.parse(localStorage.getItem("jokeVotes"))[currentJoke.punchline];currentJoke.votes=l?l.votes:0,updateVoteDisplay()}catch(e){console.error("Error loading joke:",e),jokeLead.textContent="Error loading joke",jokePunchline.textContent="Please try again later"}}function updateVoteDisplay(){voteCount.textContent=`Votes: ${currentJoke.votes}`}function handleVote(e){const t=JSON.parse(localStorage.getItem("jokeVotes"));t[currentJoke.punchline]||(t[currentJoke.punchline]={lead:currentJoke.lead,punchline:currentJoke.punchline,votes:0}),t[currentJoke.punchline].votes+=e,localStorage.setItem("jokeVotes",JSON.stringify(t)),currentJoke.votes=t[currentJoke.punchline].votes,updateVoteDisplay()}function showLeaderboard(){const e=JSON.parse(localStorage.getItem("jokeVotes")),t=Object.entries(e).map(([,e])=>e).sort((e,t)=>t.votes-e.votes).slice(0,10);leaderboardList.innerHTML=t.map((e,t)=>`\n            <div class="leaderboard-item">\n                <strong>#${t+1}</strong> (${e.votes} votes)<br>\n                <span class="leaderboard-joke-lead">${e.lead}</span><br>\n                <span class="leaderboard-joke-punchline">${e.punchline}</span>\n            </div>\n        `).join(""),leaderboardModal.style.display="block"}localStorage.getItem("jokeVotes")||localStorage.setItem("jokeVotes",JSON.stringify({}));const jokeLead=document.getElementById("joke-lead"),jokePunchline=document.getElementById("joke-punchline"),thumbsUpBtn=document.getElementById("thumbs-up"),thumbsDownBtn=document.getElementById("thumbs-down"),leaderboardBtn=document.getElementById("leaderboard-btn"),voteCount=document.getElementById("vote-count"),leaderboardModal=document.getElementById("leaderboard-modal"),leaderboardList=document.getElementById("leaderboard-list"),closeBtn=document.querySelector(".close"),container=document.querySelector(".container");let currentJoke={lead:"",punchline:"",votes:0};thumbsUpBtn.addEventListener("click",()=>handleVote(1)),thumbsDownBtn.addEventListener("click",()=>handleVote(-1)),leaderboardBtn.addEventListener("click",showLeaderboard),closeBtn.addEventListener("click",()=>{leaderboardModal.style.display="none"}),window.addEventListener("click",e=>{e.target===leaderboardModal&&(leaderboardModal.style.display="none")}),loadJoke(),setInterval(loadJoke,36e5);